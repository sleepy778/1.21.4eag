<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minecraft Browser Client</title>
</head>
<body>
    <h1>Minecraft Browser Client</h1>
    <button id="loginBtn">Sign in with Microsoft</button>
    <script>
        const loginBtn = document.getElementById('loginBtn');

        loginBtn.onclick = async () => {
            // Step 1: Open Microsoft OAuth (replace with your app/client ID)
            const oauthUrl = "https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize?client_id=YOUR_CLIENT_ID&response_type=code&redirect_uri=http://localhost:3000&scope=XboxLive.signin%20offline_access";
            const win = window.open(oauthUrl, "_blank", "width=500,height=600");

            // In a real app, youâ€™d handle the redirect back to your server to get the code
            alert("After login, copy the code from the URL and paste here for testing");
            const code = prompt("Paste OAuth code here:");

            // Step 2: Exchange code for Minecraft token
            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code })
            });
            const result = await res.json();
            const token = result.access_token;
            const username = result.selectedProfile.name;

            console.log("Logged in as:", username);

            // Step 3: Connect to a Minecraft server via WebSocket
            const ws = new WebSocket('ws://localhost:8080');
            ws.onopen = () => {
                ws.send(JSON.stringify({
                    host: 'play.hypixel.net',    // example server
                    port: 25565,
                    username,
                    token
                }));
            };

            ws.onmessage = (event) => console.log('Packet from server:', event.data);
        };
    </script>
</body>
</html>
